<!--- DO NOT EDIT: generated by resolver/tools/generate_schemas_md.py on 2025-10-05Z -->

# Resolver Schemas

## DuckDB snapshot keys and canonicalisation

- The natural key for `facts_resolved` is `(ym, iso3, hazard_code, metric, series_semantics)`.
- `series_semantics` values are canonicalised *before* duplicate rows are dropped; all values map to the set `"" | "new" | "stock"` after trimming and normalising case.
- Snapshot writes perform a month-scoped delete on `facts_resolved` and, when present, `facts_deltas` before new rows are inserted.
- Upserts explicitly list target columns in `INSERT` statements to avoid column-order mismatches when DataFrame columns are reordered.

## Table of contents

- [staging.common](#stagingcommon)
- [staging.unhcr_odp](#stagingunhcrodp)
- [staging.worldpop](#stagingworldpop)

## staging.common

Canonical staging columns for event-centric connectors.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| as_of_date | date | yes |  |  |
| confidence | string | yes |  |  |
| country_name | string | yes |  |  |
| definition_text | string | yes |  |  |
| doc_title | string | yes |  |  |
| event_id | string | yes |  |  |
| hazard_class | string | yes |  |  |
| hazard_code | string | yes |  |  |
| hazard_label | string | yes |  |  |
| ingested_at | date | yes |  |  |
| iso3 | string | yes |  |  |
| method | string | yes |  |  |
| metric | enum | yes | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| publication_date | date | yes |  |  |
| publisher | string | yes |  |  |
| revision | integer | yes |  |  |
| source_type | string | yes |  |  |
| source_url | string | yes |  |  |
| unit | enum | yes | persons, persons_cases, events |  |
| value | number | yes |  |  |
| delta_negative_clamped | integer | no |  |  |
| first_observation | integer | no |  |  |
| rebase_flag | integer | no |  |  |
| series_semantics | enum | no | stock, new |  |
| value_new | number | no |  |  |
| value_stock | number | no |  |  |

## staging.unhcr_odp

UNHCR Operational Data Portal staging output.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| as_of_date | date | yes |  |  |
| country_iso3 | string | yes |  |  |
| country_name | string | yes |  |  |
| evidence_label | string | yes |  |  |
| evidence_url | string | yes |  |  |
| hazard_class | string | yes |  |  |
| hazard_code | string | yes |  |  |
| hazard_label | string | yes |  |  |
| metric_name | string | yes |  |  |
| metric_unit | string | yes |  |  |
| source | string | yes |  |  |
| source_event_id | string | yes |  |  |
| value | number | yes |  |  |
| metric | enum | no | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| series_semantics | enum | no | stock, new |  |
| unit | enum | no | persons, persons_cases, events |  |

## staging.worldpop

WorldPop denominators staging output.

| Name | Type | Required | Enum/Format | Description |
| --- | --- | --- | --- | --- |
| download_date | date | yes |  |  |
| iso3 | string | yes |  |  |
| population | number | yes |  |  |
| product | string | yes |  |  |
| source | string | yes |  |  |
| source_url | string | yes |  |  |
| year | integer | yes |  |  |
| metric | enum | no | in_need, affected, displaced, cases, fatalities<br>events, participants |  |
| notes | string | no |  |  |
| unit | enum | no | persons, persons_cases, events |  |
